<!-- start custom head snippets -->

<!-- ==================== Favicon ==================== -->
<link rel="icon" type="image/png" href="{{ "/assets/images/fav.png" | relative_url }}">


<!-- ==================== 全部 CSS 样式 ==================== -->
<style>
/* ============================
   字体定义
   ============================ */
.body-font,
.news-font,
.time-font {
  font-family: Sinhala MN, Optima, Arial, sans-serif;
}

.title-font {
  font-family: Rockwell, Optima, Arial, sans-serif;
}

.side-font {
  font-family: Skia, Optima, Arial, sans-serif;
}


/* ============================
   页面基础样式
   ============================ */
.page__meta,
.page__date {
  display: none !important;
}

.site-logo,
.site-title {
  margin-right: 30px !important;
}

.site-title {
  display: none !important;
}

.author__name {
  font-weight: 600 !important;
}

.header-link,
.page__title {
  display: none;
}

.page__content {
  margin-top: -50px;
}

.no-border {
  border-bottom: none !important;
}

.greedy-nav .search__toggle {
  display: none !important;
}


/* ============================
   导航栏固定
   ============================ */
.masthead {
  position: sticky;
  top: 0;
  z-index: 1000;
  background-color: #f3f6f6;
}

body.dark-mode .masthead {
  background-color: #16213e;
}


/* ============================
   侧边栏
   ============================ */
.sidebar.sticky {
  top: 70px !important;
}

.sidebar .author__avatar {
  display: grid;
  grid-template-rows: 1fr;
  transition: grid-template-rows 0.4s ease, opacity 0.4s ease;
}

.sidebar .author__avatar > * {
  overflow: hidden;
}

.sidebar.scrolled .author__avatar {
  grid-template-rows: 0fr;
  opacity: 0;
}

.sidebar.scrolled .author__content {
  margin-top: 0px;
  transition: margin-top 0.4s ease;
}


/* ============================
   锚点跳转预留空间
   ============================ */
#open-source-projects,
#latest-news,
#fun-facts,
#visitors {
    padding-top: 80px;
    margin-top: -60px;
}

#about, #news {
    padding-top: 80px;
    border-bottom: none !important;
    margin-top: -20px;
    margin-bottom: -10px !important;
}


/* ============================
   Dark Mode 样式
   ============================ */
body.dark-mode {
  background-color: #1a1a2e;
  color: #eaeaea;
}

body.dark-mode .masthead,
body.dark-mode .greedy-nav {
  background-color: #16213e;
}

body.dark-mode .page__content {
  background-color: #1a1a2e;
}

body.dark-mode a {
  color: #4fc3f7;
}

body.dark-mode .greedy-nav a {
  color: #eaeaea;
}

body.dark-mode .page__footer {
  background-color: #16213e;
  color: #eaeaea;
}

body.dark-mode .invert-dark {
  filter: invert(1);
}

body.dark-mode .site-logo img {
  filter: invert(1);
  background-color: transparent !important;
  background: none !important;
}

body.dark-mode .sidebar {
  background-color: transparent;
}

body.dark-mode .author__urls.social-icons {
  box-shadow: none !important;
}

body.dark-mode .author__urls i,
body.dark-mode .author__urls .fab,
body.dark-mode .author__urls .fas,
body.dark-mode .author__urls a,
body.dark-mode .author__bio,
body.dark-mode .author__name {
  color: #eaeaea;
}


/* ============================
   Follow 按钮样式
   ============================ */
.author__urls-wrapper button.btn--inverse {
  font-family: Skia, Optima, Arial, sans-serif !important;
  font-weight: 500;
}

body.dark-mode .author__urls-wrapper button,
body.dark-mode .author__urls-wrapper .btn {
  background-color: #333;
  color: #eaeaea;
  border-color: #555;
}

body.dark-mode .author__urls-wrapper .author__urls {
  background-color: #1a1a2e;
  border-color: #333;
  box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

body.dark-mode .author__urls-wrapper .author__urls a {
  color: #eaeaea;
}

body.dark-mode .author__urls-wrapper .author__urls a:hover {
  background-color: #333;
}


/* ============================
   汉堡菜单按钮
   ============================ */
.greedy-nav__toggle {
  display: none !important;
}

.hidden-links {
  visibility: hidden !important;
  position: absolute !important;
  pointer-events: none !important;
}

#hamburger-btn {
  cursor: pointer;
  padding: 0 15px;
  font-size: 1em;
  display: inline-flex;
  align-items: center;
  height: 100%;
}

#hamburger-btn i {
  display: inline-block;
  font-size: 1.1em;
  transition: transform 0.3s ease, opacity 0.2s ease;
}

#hamburger-btn.active i {
  transform: rotate(180deg);
}


/* ============================
   汉堡下拉菜单
   ============================ */
#custom-dropdown {
  display: none;
  position: fixed;
  background: #fff;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  border-radius: 8px;
  z-index: 9999;
  min-width: 200px;
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 0.2s ease, transform 0.2s ease, min-width 0.3s ease;  /* 合并 */
}

#custom-dropdown.show {
  opacity: 1;
  transform: translateY(0);
}

#custom-dropdown a {
  display: block;
  padding: 12px 20px;
  text-decoration: none;
  color: #333;
}

#custom-dropdown a:hover {
  background: #f5f5f5;
}

.dropdown-divider {
  margin: 5px 0;
  border: none;
  border-top: 1px solid #eee;
}

body.dark-mode .dropdown-divider {
  border-top-color: #333;
}

body.dark-mode #custom-dropdown {
  background: #16213e;
}

body.dark-mode #custom-dropdown a {
  color: #eaeaea;
}

body.dark-mode #custom-dropdown a:hover {
  background: #1a1a2e;
}

/* ============================
   Logo 滚动隐藏
   ============================ */
.site-logo img {
  transition: opacity 0.4s ease, transform 0.4s ease;
}

body.scrolled .site-logo img {
  opacity: 0;
  transform: scale(0.8);
  pointer-events: none;
}

/* ============================
   手机端样式 (max-width: 1023px)
   ============================ */
@media (max-width: 1023px) {
  /* --- Follow 下拉菜单 --- */
  .author__urls-wrapper .author__urls::before,
  .author__urls-wrapper .author__urls::after {
    display: none !important;
  }

  .author__urls-wrapper .author__urls {
    display: block !important;
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    visibility: hidden;
    pointer-events: none;
  }

  .author__urls-wrapper .author__urls.show {
    opacity: 1;
    transform: translateY(0);
    visibility: visible;
    pointer-events: auto;
  }

  body.dark-mode .author__urls-wrapper .author__urls {
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
  }

  /* --- Sidebar 样式 --- */
  .sidebar,
  .sidebar.sticky {
    background-color: transparent !important;
    height: auto !important;
    min-height: auto !important;
    overflow: visible !important;
  }

  .sidebar .author__avatar a,
  .sidebar .author__name a {
    pointer-events: none !important;
    cursor: default !important;
  }

  body.dark-mode .page__content {
    background-color: transparent !important;
  }

  /* --- 锚点跳转 --- */
  #open-source-projects,
  #latest-news,
  #fun-facts,
  #visitors {
    padding-top: 60px;
    margin-top: -60px;
  }

  #about,
  #news {
    padding-top: 60px;
    border-bottom: none !important;
    margin-top: -20px;
    margin-bottom: -10px !important;
  }

  /* --- Fun Facts 表格布局 --- */
  #fun-facts + table tr {
    display: flex;
    flex-direction: column;
  }

  #fun-facts + table td {
    width: 100% !important;
    display: block;
    text-align: center;
  }

  #fun-facts + table ul {
    text-align: left;
    display: inline-block;
  }

  /* --- 侧边栏横向布局 --- */
  .sidebar .h-card {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 15px;
    height: auto !important;
    min-height: auto !important;
  }

  /* 头像 - 左边 */
  .sidebar .author__avatar {
    width: max(75px, 10%);
    flex-shrink: 0;
    margin: 0;
    overflow: visible !important;
    height: auto !important;
  }

  .sidebar .author__avatar a {
    display: block;
  }

  .sidebar .author__avatar img.u-photo {
    width: 100% !important;
    height: auto !important;
    aspect-ratio: 1 / 1;
    max-width: none !important;
    max-height: none !important;
    padding: 5px !important;
    border: 1px solid rgb(207, 212, 211) !important;
    border-radius: 50% !important;
    box-sizing: border-box;
  }

  body.dark-mode .sidebar .author__avatar img.u-photo {
    border-color: #555 !important;
  }

  /* 文字介绍 - 中间 */
  .sidebar .author__content {
    flex: 1;
    text-align: left;
    display: flex;
    flex-direction: column;
    justify-content: center;
    height: auto !important;
    min-height: auto !important;
  }

  .sidebar .author__bio {
    height: auto !important;
  }

  .sidebar .author__bio p {
    margin: 0 !important;
  }

  /* Follow 按钮 - 右边 */
  .sidebar .author__urls-wrapper {
    flex-shrink: 0;
  }

  /* 取消手机端头像滚动隐藏效果 */
  .sidebar.scrolled .author__avatar {
    grid-template-rows: 1fr;
    opacity: 1;
  }
}


  /* ============================
    导航栏滚动变窄
    ============================ */
  .masthead {
    transition: padding 0.3s ease, box-shadow 0.3s ease;
  }

  .masthead .masthead__inner-wrap {
    transition: padding 0.3s ease;
  }

  /* 滚动后变窄 + 加阴影 */
  body.scrolled .masthead {
    padding-top: 0;
    padding-bottom: 0;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  body.scrolled .masthead .masthead__inner-wrap {
    padding-top: 0.1em;
    padding-bottom: 0.1em;
  }

  /* Dark mode 阴影 */
  body.dark-mode.scrolled .masthead {
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }

  /* Logo 滚动隐藏 */
  .site-logo {
    transition: opacity 0.4s ease, transform 0.4s ease, max-height 0.3s ease, margin 0.3s ease;
  }

  body.scrolled .site-logo {
    opacity: 0;
    max-height: 0;
    margin: 0;
    overflow: hidden;
    pointer-events: none;
  }

  /* 导航链接也变小 */
  .greedy-nav {
    transition: min-height 0.3s ease;
  }

  body.scrolled .greedy-nav {
    min-height: auto;
  }

  .greedy-nav a {
    transition: padding 0.3s ease, font-size 0.3s ease;
  }

  body.scrolled .greedy-nav a {
    padding-top: 0.1rem;
    padding-bottom: 0.1rem;
    font-size: 0.85em;
  }

  /* 汉堡按钮也变小 */
  body.scrolled #hamburger-btn {
    padding-top: 0.1rem;
    padding-bottom: 0.1rem;
  }

  body.scrolled #hamburger-btn i {
    font-size: 0.95em;
  }

  /* 汉堡下拉菜单字体动态变化 */
  #custom-dropdown {
    transition: opacity 0.2s ease, transform 0.2s ease, min-width 0.3s ease;
  }

  #custom-dropdown a {
    transition: padding 0.3s ease, font-size 0.3s ease;
  }

  body.scrolled #custom-dropdown {
    min-width: 180px;
  }

  body.scrolled #custom-dropdown a {
    padding: 8px 16px;
    font-size: 0.85em;
  }

  /* 分隔线也变窄 */
  body.scrolled #custom-dropdown .dropdown-divider {
    margin: 3px 0;
  }

</style>


<!-- ==================== 全部 JavaScript ==================== -->
<script>
document.addEventListener('DOMContentLoaded', function() {

  /* ============================
   主题切换
   ============================ */
const themeBtn = document.getElementById('theme-toggle');
if (themeBtn) {
  // 检查是否有保存的主题偏好
  const savedTheme = localStorage.getItem('theme');
  
  if (savedTheme) {
    // 使用保存的主题
    document.body.classList.toggle('dark-mode', savedTheme === 'dark');
    themeBtn.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
  } else {
    // 没有保存的主题，使用系统主题
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    document.body.classList.toggle('dark-mode', systemDark);
    themeBtn.innerHTML = systemDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
  }

  themeBtn.parentElement.addEventListener('click', function(e) {
    e.preventDefault();
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    themeBtn.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    // 保存主题偏好
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  });

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
    // 只有没有手动设置过主题时，才跟随系统
    if (!localStorage.getItem('theme')) {
      document.body.classList.toggle('dark-mode', e.matches);
      themeBtn.innerHTML = e.matches ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }
  });
}


  /* ============================
     汉堡菜单
     ============================ */
  const dropdown = document.createElement('div');
  dropdown.id = 'custom-dropdown';
  document.body.appendChild(dropdown);

  const fixedItems = `
    <div class="dropdown-section fixed-items">
      <a href="/#about" class='side-font'>About</a>
      <a href="/#open-source-projects" class='side-font'>Open-Source Projects</a>
      <a href="/#latest-news" class='side-font'>Latest News</a>
      <a href="/#fun-facts" class='side-font'>Fun Facts</a>
      <a href="/#visitors" class='side-font'>Visitors</a>
    </div>
  `;

  let pauseUpdate = false;

  function updateDropdown() {
    if (pauseUpdate) return;
    
    const hiddenLinks = document.querySelector('.hidden-links');
    let dynamicItems = '';
    
    if (hiddenLinks && hiddenLinks.children.length > 0) {
      dynamicItems = '<div class="dropdown-section dynamic-items">';
      Array.from(hiddenLinks.children).forEach(function(li) {
        const link = li.querySelector('a');
        if (link) {
          dynamicItems += `<a href="${link.getAttribute('href')}" class="side-font">${link.innerHTML}</a>`;
        }
      });
      dynamicItems += '</div>';
    }
    
    dropdown.innerHTML = dynamicItems 
      ? dynamicItems + '<hr class="dropdown-divider">' + fixedItems 
      : fixedItems;

    // 重新绑定主题切换按钮事件
    const themeToggleInDropdown = dropdown.querySelector('#theme-toggle');
    if (themeToggleInDropdown) {
      themeToggleInDropdown.closest('a').addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        
        document.querySelectorAll('#theme-toggle').forEach(function(btn) {
          btn.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });
        
        // 关闭下拉菜单
        dropdown.classList.remove('show');
        const hamburger = document.getElementById('hamburger-btn');
        if (hamburger) {
          hamburger.classList.remove('active');
          hamburger.querySelector('i').classList.replace('fa-times', 'fa-bars');
        }
        setTimeout(function() {
          dropdown.style.display = 'none';
        }, 200);
      });
    }
  }

  updateDropdown();

  // 监听 hidden-links 变化
  const hiddenLinks = document.querySelector('.hidden-links');
  if (hiddenLinks) {
    const observer = new MutationObserver(updateDropdown);
    observer.observe(hiddenLinks, { childList: true, subtree: true });
  }

  window.addEventListener('resize', updateDropdown);

  // 插入汉堡菜单按钮
  const nav = document.querySelector('.greedy-nav');
  if (nav) {
    const hamburger = document.createElement('span');
    hamburger.id = 'hamburger-btn';
    hamburger.innerHTML = '<i class="fas fa-bars"></i>';
    nav.appendChild(hamburger);
    
    hamburger.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      if (dropdown.classList.contains('show')) {
        dropdown.classList.remove('show');
        hamburger.classList.remove('active');
        hamburger.querySelector('i').classList.replace('fa-times', 'fa-bars');
        setTimeout(() => dropdown.style.display = 'none', 200);
        return;
      }

      if (dropdown.style.display === 'block' && dropdown.style.visibility === 'visible') {
        dropdown.style.display = 'none';
        hamburger.classList.remove('active');
        hamburger.querySelector('i').classList.replace('fa-times', 'fa-bars');
        return;
      }
      
      updateDropdown();
      
      const rect = hamburger.getBoundingClientRect();
      const windowWidth = window.innerWidth;
      
      dropdown.style.position = 'fixed';
      dropdown.style.visibility = 'hidden';
      dropdown.style.display = 'block';
      
      const dropdownWidth = dropdown.offsetWidth;
      dropdown.style.top = rect.bottom + 10 + 'px';
      
      const iconCenter = rect.left + rect.width / 2;
      let dropdownLeft = iconCenter - dropdownWidth / 2;
      
      if (dropdownLeft + dropdownWidth > windowWidth - 10) {
        dropdown.style.right = '10px';
        dropdown.style.left = 'unset';
      } else if (dropdownLeft < 10) {
        dropdown.style.left = '10px';
        dropdown.style.right = 'unset';
      } else {
        dropdown.style.left = dropdownLeft + 'px';
        dropdown.style.right = 'unset';
      }
      
      dropdown.style.visibility = 'visible';
      setTimeout(() => dropdown.classList.add('show'), 10);
      hamburger.classList.add('active');
      hamburger.querySelector('i').classList.replace('fa-bars', 'fa-times');
    });
  }

  // 点击其他地方关闭
  document.addEventListener('click', function(e) {
    const hamburger = document.getElementById('hamburger-btn');
    if (hamburger && !hamburger.contains(e.target) && !dropdown.contains(e.target)) {
      dropdown.classList.remove('show');
      hamburger.classList.remove('active');
      hamburger.querySelector('i').classList.replace('fa-times', 'fa-bars');
      setTimeout(() => dropdown.style.display = 'none', 200);
    }
  });

  // 点击菜单项后关闭
  dropdown.addEventListener('click', function(e) {
    if (e.target.tagName === 'A') {
      pauseUpdate = true;
      dropdown.classList.remove('show');
      const hamburger = document.getElementById('hamburger-btn');
      if (hamburger) {
        hamburger.classList.remove('active');
        hamburger.querySelector('i').classList.replace('fa-times', 'fa-bars');
      }
      setTimeout(function() {
        dropdown.style.display = 'none';
        pauseUpdate = false;
      }, 200);
    }
  });


  /* ============================
     Follow 按钮下拉菜单
     ============================ */
  function initFollowMenu() {
    const followBtn = document.querySelector('.author__urls-wrapper button');
    const followMenu = document.querySelector('.author__urls-wrapper .author__urls');
    
    if (followBtn && followMenu) {
      followMenu.classList.remove('show', 'is--visible', 'open');
      followBtn.classList.remove('open');
      
      followBtn.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        followMenu.classList.toggle('show');
        return false;
      };
    }
  }
  
  function resetAllState() {
    const followMenu = document.querySelector('.author__urls-wrapper .author__urls');
    const followBtn = document.querySelector('.author__urls-wrapper button');
    
    if (followMenu) {
      followMenu.classList.remove('show', 'is--visible', 'open');
    }
    if (followBtn) {
      followBtn.classList.remove('open');
    }
    
    document.body.click();
  }
  
  setTimeout(initFollowMenu, 100);
  
  window.addEventListener('focus', function() {
    resetAllState();
    setTimeout(initFollowMenu, 50);
  });
  
  window.addEventListener('pageshow', function(e) {
    if (e.persisted) {
      resetAllState();
      setTimeout(initFollowMenu, 50);
    }
  });
  
  document.addEventListener('visibilitychange', function() {
    if (document.visibilityState === 'visible') {
      resetAllState();
      setTimeout(initFollowMenu, 50);
    }
  });
  
  // Follow 菜单：点击其他地方关闭
  document.addEventListener('click', function(e) {
    const followBtn = document.querySelector('.author__urls-wrapper button');
    const followMenu = document.querySelector('.author__urls-wrapper .author__urls');
    if (followBtn && followMenu && !followBtn.contains(e.target) && !followMenu.contains(e.target)) {
      followMenu.classList.remove('show');
    }
  });

  // Follow 菜单：窗口大小变化时关闭
  window.addEventListener('resize', function() {
    const followMenu = document.querySelector('.author__urls-wrapper .author__urls');
    if (followMenu) {
      followMenu.classList.remove('show');
    }
  });

  // Follow 菜单：点击链接后关闭
  document.addEventListener('click', function(e) {
    const link = e.target.closest('.author__urls a');
    if (link) {
      const followMenu = document.querySelector('.author__urls-wrapper .author__urls');
      if (followMenu) {
        setTimeout(function() {
          followMenu.classList.remove('show');
        }, 50);
      }
    }
  });


  /* ============================
   锚点跳转修正
   ============================ */
  // 动态获取导航栏高度
  function getNavHeight() {
    const masthead = document.querySelector('.masthead');
    return masthead ? masthead.offsetHeight + 10 : 80;  // +10 留点间距
  }

  // 页面加载时检查 hash
  if (window.location.hash) {
    setTimeout(function() {
      const target = document.querySelector(window.location.hash);
      if (target) {
        const navHeight = getNavHeight();
        const targetPosition = target.getBoundingClientRect().top + window.scrollY - navHeight;
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
      }
    }, 100);
  }

  // 监听 hash 变化
  window.addEventListener('hashchange', function() {
    setTimeout(function() {
      const target = document.querySelector(window.location.hash);
      if (target) {
        const navHeight = getNavHeight();
        const targetPosition = target.getBoundingClientRect().top + window.scrollY - navHeight;
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
      }
    }, 50);  // 延迟一点等导航栏高度稳定
  });

  /* ============================
     侧边栏滚动效果 & 链接设置
     ============================ */
  // 侧边栏链接新窗口打开
  document.querySelectorAll('.author__urls a').forEach(function(link) {
    const href = link.getAttribute('href');
    if (href && (href.startsWith('http') || href.startsWith('mailto:'))) {
      link.setAttribute('target', '_blank');
      link.setAttribute('rel', 'noopener noreferrer');
    }
  });

  // 滚动隐藏头像和 Logo
  window.addEventListener('scroll', function() {
    const sidebar = document.querySelector('.sidebar');
    
    if (window.scrollY > 0) {
      document.body.classList.add('scrolled');
      if (sidebar) sidebar.classList.add('scrolled');
    } else {
      document.body.classList.remove('scrolled');
      if (sidebar) sidebar.classList.remove('scrolled');
    }
  });

  // 页脚链接新窗口打开
  document.querySelectorAll('.page__footer a').forEach(function(link) {
    const href = link.getAttribute('href');
    if (href && href.startsWith('http')) {
      link.setAttribute('target', '_blank');
      link.setAttribute('rel', 'noopener noreferrer');
    }
  });


  /* ============================
     Spotify 主题适配
     ============================ */
  function updateSpotifyTheme() {
    const isDark = document.body.classList.contains('dark-mode');
    const theme = isDark ? '0' : '1';
    
    document.querySelectorAll('.spotify-embed').forEach(function(iframe) {
      let src = iframe.src;
      src = src.replace(/[?&]theme=\d/, '');
      if (src.includes('?')) {
        src += '&theme=' + theme;
      } else {
        src += '?theme=' + theme;
      }
      iframe.src = src;
    });
  }

  updateSpotifyTheme();

  const themeToggle = document.getElementById('theme-toggle');
  if (themeToggle) {
    themeToggle.closest('a').addEventListener('click', function() {
      setTimeout(updateSpotifyTheme, 100);
    });
  }

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
    setTimeout(updateSpotifyTheme, 100);
  });


  /* ============================
     访客地图
     ============================ */
  const lightMap = "https://mapmyvisitors.com/map.js?cl=62dfcb&w=a&t=tt&d=aFHblOyhRqrPEOjLMyGLqfSPaAmR560E6X2mqPT4da0&co=f3f6f6&cmo=2b7a78&cmn=ffb347&ct=62dfcb";
  const darkMap = "https://mapmyvisitors.com/map.js?cl=eaeaea&w=a&t=tt&d=aFHblOyhRqrPEOjLMyGLqfSPaAmR560E6X2mqPT4da0&co=1a1a2e&cmo=4fc3f7&cmn=ffb347";
  let resizeTimeout;

  function loadMap() {
    const container = document.getElementById('mapmyvisitors-container');
    if (!container) return;
    
    const isDark = document.body.classList.contains('dark-mode');
    container.innerHTML = '';
    
    const script = document.createElement('script');
    script.type = 'text/javascript';
    script.id = 'mapmyvisitors';
    script.src = isDark ? darkMap : lightMap;
    container.appendChild(script);
  }

  loadMap();

  // 地图链接点击
  const mapContainer = document.getElementById('mapmyvisitors-container');
  if (mapContainer) {
    mapContainer.addEventListener('click', function(e) {
      const link = e.target.closest('a');
      if (link) {
        e.preventDefault();
        window.open(link.href, '_blank', 'noopener,noreferrer');
      }
    });
  }

  // 窗口大小变化时重新加载
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(loadMap, 500);
  });

  // 主题切换时重新加载地图
  const mapThemeToggle = document.getElementById('theme-toggle');
  if (mapThemeToggle) {
    mapThemeToggle.closest('a').addEventListener('click', function() {
      setTimeout(loadMap, 100);
    });
  }

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
    setTimeout(loadMap, 100);
  });

});
</script>


<!-- ==================== Google Analytics ==================== -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E3W94CY71D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-E3W94CY71D');
</script>

<!-- end custom head snippets -->